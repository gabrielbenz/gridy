/*!
 * jQuery Gridy - A Grid Plugin - http://wbotelhos.com/gridy
 * 
 * @author	Washington Botelho
 * @twitter wbotelhos
 * @version 0.1.0
 * 
 * Licensed under The MIT License
 * http://opensource.org/licenses/mit-license.php
 * 
 */

(function(b){var a={init:function(c){},getSize:function(c){return(isNaN(parseInt(c)))?c:c+"px";},getNumber:function(c){return(c<10)?"0"+c:c;},getError:function(c){return(c.responseText)?c.responseText.substring(c.responseText.indexOf("(")+1,c.responseText.indexOf(")")):c.statusText;},getNumber:function(c){return(c<10)?"0"+c:c;},debug:function(c){if(window.console&&window.console.log){window.console.log(c);}}};b.fn.gridy=function(Q){if(this.length==0){a.debug("Selector invalid or missing!");return;}else{if(this.length>1){return this.each(function(){b.fn.gridy.apply(b(this),[Q]);});}}var v=b.extend({},b.fn.gridy.defaults,Q),I=this.attr("id"),n=b(this),G=b('<input id="current-page" type="hidden" value="'+v.page+'"/>').appendTo(n),m=b('<input id="current-sort-name" type="hidden" value="'+v.sortName+'"/>').appendTo(n),r=b('<input id="current-sort-order" type="hidden" value="'+v.sortOrder+'"/>').appendTo(n);if(I===undefined){I="gridy-"+n.index();n.attr("id",I);}n.addClass(v.templateStyle).data("options",v);var K=null,N=null;if(v.searchOption){var S=b('<div class="search"/>').appendTo(n);K=b('<input id="key" type="text" size="35" maxlength="40" value="'+((v.search=="")?v.searchText:v.search)+'" title="'+v.searchText+'"/>').appendTo(S);K.blur(function(){if(K.val()==""){K.removeClass("typed").val(v.searchText);}}).focus(function(){if(K.val()==v.searchText){K.addClass("typed").val("");}}).keypress(function(i){if((i.keyCode?i.keyCode:i.which)==13){J(1,m.val(),r.val());}});N=b('<input type="button" value="search" title="consultar"/>').appendTo(S);N.click(function(){J(1,m.val(),r.val());});}var s=null,A=null;if(v.sortOption&&v.sortList.length>0){var k="",M="";for(var O=0;O<v.sortList.length;O++){M=v.sortList[O];k+='<div class="sort-item"><div class="'+v.arrowNone+'"></div><a id="sort-by-'+M+'" href="javascript:void(0);" name="'+M+'" rel="desc">'+M+"</a></div>";}s=b('<div class="sort-bar"/>').css("width",a.getSize(v.sortWidth)).html(k).appendTo(n);A=s.children("div.sort-item");A.delegate("a","click",E);}function E(){l(b(this));}function x(i,V,W,U){if(U){s.find("a.sorted").attr("rel","desc").removeClass("sorted").prev("div").removeClass().addClass("arrow-none");}i.attr("rel",V).addClass("sorted").prev("div").removeClass().addClass(W);}function l(Y){var W=Y.attr("name"),V=Y.attr("rel"),U=(V=="desc")?"asc":"desc",X=(V=="desc")?"arrow-up":"arrow-down",i=s.find("a.sorted").length>0;x(Y,U,X,i);J(G.val(),W,U);}if(v.sortOption&&v.sortList.length>0){var z=b("a#sort-by-"+v.sortName);if(!z.length){v.sortName=v.sortList[0];z=b("a#sort-by-"+v.sortName);}var B=(v.sortOrder=="asc")?"arrow-up":"arrow-down",R=false;x(z,v.sortOrder,B,R);}var L=null;if(v.loadingOption){L=b('<div class="'+v.loadingIcon+'"><div>'+v.loadingText+"</div></div>").appendTo(n).children();}var C=null;if(v.resultOption){C=b('<div class="result"/>').appendTo(n);}var g=b('<div class="content"/>').css({height:a.getSize(v.height),width:a.getSize(v.width)}).appendTo(n);function o(i){if(v.loadingOption){if(i){L.fadeIn("fast");g.addClass("fade");}else{L.fadeOut();g.removeClass("fade");}}}function u(){if(v.noResultOption){g.html('<p class="no-result">'+v.noResultText+"</p>");if(v.resultOption){C.html(C.html().replace(/\d+/g,"--"));}if(v.searchOption){K.focus().select();}}}var y=null;if(v.findOption||v.rowsOption||v.messageOption){y=b('<div class="footer"/>').css("width",a.getSize(v.width)).appendTo(n);}var h=null;if(v.findOption){h=b('<div class="find-option"><select></select></div>').appendTo(y).children();var e=false,D="",q="";if(v.findList.length==0&&v.sortList.length>0){v.findList=v.sortList;v.find=v.sortList[0];}else{if(v.findList.length>0){v.find=v.findList[0];}}for(var O=0;O<v.findList.length;O++){q=v.findList[O];D+='<option value="'+q+'">'+q+"</option>";if(q==v.find){e=true;}}if(!e){h.html('<option value="'+v.find+'" checked="checked">'+v.find+"</option>");}h.append(D).val(v.find).change().change(function(i,U){J(1,m.val(),r.val());}).children('option[value="'+v.find+'"]').attr("checked","checked");}var p=null;if(v.rowsOption){p=b('<div class="row-option"><select></select></div>').appendTo(y).children();var P=(v.rows<1)?1:v.rows,H=false,D="",T="";for(var O=0;O<v.rowsList.length;O++){T=v.rowsList[O];if(T==P){H=true;}D+='<option value="'+T+'">'+a.getNumber(T)+"</option>";}if(!H){p.html('<option value="'+P+'" checked="checked">'+a.getNumber(P)+"</option>");}p.append(D).val(P).change().change(function(i,U){J(1,m.val(),r.val());}).children('option[value="'+P+'"]').attr("checked","checked");}var t=null;if(v.buttonOption){t=b('<div class="buttons"/>').css("width",a.getSize(v.buttonsWidth)).appendTo(n);}var d=(v.scroll)?"-scroll":"";if(v.hoverFx){n.delegate("div.content > div","mouseenter",function(){b(this).addClass("item-hover"+d);}).delegate("div.content > div","mouseleave",function(){b(this).removeClass("item-hover"+d);});}if(v.clickFx){n.delegate("div.content > div","click",function(i){var U=b(this);if(!i.shiftKey){U.parent().children("div.item-active"+d).removeClass("item-active"+d);}U.toggleClass("item-active"+d);});}var f=null;if(v.messageOption){f=b('<div class="message"/>').appendTo(y);}function F(i){if(v.messageOption){f.html(i).show();setTimeout(function(){f.fadeOut();},v.messageTimer);}}J(v.page,v.sortName,v.sortOrder);function j(i){console.log("sdfasdf");i.preventDefault();}function w(i){if(i){if(v.searchOption){K.removeAttr("readonly");N.removeAttr("disabled");}if(v.sortOption){A.delegate("a","click",E);}if(v.buttonOption){t.children().removeAttr("disabled");}if(v.findOption){h.removeAttr("disabled");}if(v.rowsOption){p.removeAttr("disabled");}}else{if(v.searchOption){K.attr("readonly","readonly");N.attr("disabled","disabled");}if(v.sortOption){A.undelegate("a","click");}if(v.buttonOption){t.children().attr("disabled","disabled");}if(v.findOption){h.attr("disabled","disabled");}if(v.rowsOption){p.attr("disabled","disabled");}}}function c(U,ad,af,V,X){if(typeof(U)=="string"){U=b.parseJSON(U);}if(v.before){var ag=v.before.apply(n,[U,ad,af,V]);if(ag){U=ag;}}if(U.total==0){u();w(true);return;}else{if(v.sortOption&&v.sortList.length>0){s.show();}}var Y=U.entityList;g.html(b("#"+v.template).tmpl(Y));if(v.colsWidth){g.children("div").addClass("row").each(function(){b(this).children("div").addClass("column").each(function(i){b(this).width(v.colsWidth[i]);});});}var W=U.total%X,ab=(U.total-W)/X;if(W>0){ab++;}if(v.resultOption){var ac=v.resultText.replace(/{from}/,a.getNumber(ad)).replace(/{to}/,a.getNumber(ab)).replace(/{total}/,a.getNumber(U.total));C.html(ac);}w(true);if(v.buttonOption){if(U.total>X){var ae="",Z=0;for(var aa=1;aa<=ab;aa++){Z=a.getNumber(aa);ae+='<input type="button" value="'+Z+'" alt="'+Z+'" title="'+v.buttonTitle+" "+Z+'"/>&nbsp;';}t.html(ae).children().click(function(){J(parseInt(this.alt,10),m.val(),r.val());});}else{t.empty();}b('input[value="'+a.getNumber(ad)+'"]').attr("disabled","disabled").addClass("active");}G.val(ad);m.val(af);r.val(V);}function J(W,V,U){w(false);o(true);var i=v.search,X=(v.rowsOption)?p.val():v.rows,Y=(v.findOption)?h.val():v.find;if(v.searchOption){i=(K.val()==v.searchText)?"":K.val();if(v.searchFocus){K.focus();}}if(v.data!=null){c(v.data,W,V,U);return;}if(v.debug){a.debug("query string: key="+i+"&page="+W+"&sortName="+V+"&sortOrder="+U+"&find="+Y+"&rows="+X+v.params);}b.ajax({cache:v.cache,contentType:v.contentType,dataType:v.dataType,jsonp:v.jsonp,jsonpCallback:v.jsonpCallback,type:v.type,url:v.url,data:"key="+i+"&page="+W+"&sortName="+V+"&sortOrder="+U+"&find="+Y+"&rows="+X+v.params,success:function(Z){c(Z,W,V,U,X);if(v.success){v.success();}},error:function(ab,Z,aa){F(a.getError(ab));if(v.error){v.error();}},complete:function(){o(false);if(v.scroll){if(v.height=="auto"){a.debug(I+": height attribute missing!");}g.css({border:"1px solid #BBB",overflow:"auto"}).children("div").addClass("scroll").end().children("div:last").css("border-bottom-color","#FFF");}if(v.complete){v.complete();}}});}return n;};b.fn.gridy.defaults={arrowDown:"arrow-down",arrowNone:"arrow-none",arrowUp:"arrow-up",before:null,buttonOption:true,buttonTitle:"page",buttonsWidth:"auto",cache:false,clickFx:false,colsWidth:[],complete:null,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",debug:false,error:null,find:"id",findList:[],findOption:true,height:"auto",hoverFx:false,jsonp:false,jsonpCallback:"callback",loadingIcon:"loading",loadingOption:true,loadingText:"Loading...",messageOption:true,messageTimer:4000,noResultOption:true,noResultText:"No items found!",page:1,params:"",resultOption:true,resultText:"Displaying {from} - {to} of {total} items",rows:10,rowsList:[5,10,25,50,100],rowsOption:true,search:"",searchFocus:true,searchOption:true,searchText:"",scroll:false,sortList:[],sortName:"id",sortOption:true,sortOrder:"asc",sortWidth:"auto",success:null,template:"template",templateStyle:"gridy-default",type:"get",url:"/gridy",width:"auto"};})(jQuery);